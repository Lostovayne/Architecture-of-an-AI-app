<!doctype html>
<html lang="es">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>üß™ API H√≠brida Tester</title>
      <style>
         * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
         }
         body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
         }
         .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
         }
         h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
         }
         .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
         }
         .test-card {
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            padding: 20px;
            background: #f8f9fa;
            transition: all 0.3s ease;
         }
         .test-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
         }
         .test-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
         }
         .test-description {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9em;
         }
         input,
         textarea,
         select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            font-family: inherit;
         }
         textarea {
            height: 80px;
            resize: vertical;
         }
         button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
         }
         button:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
         }
         button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
         }
         .response {
            background: #f1f3f4;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-top: 15px;
            border-radius: 0 5px 5px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
         }
         .loading {
            color: #667eea;
            font-style: italic;
         }
         .error {
            background: #ffe6e6;
            border-left-color: #ff4444;
            color: #cc0000;
         }
         .success {
            background: #e6ffe6;
            border-left-color: #44ff44;
         }
         .model-info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.85em;
         }
         .badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            margin: 2px;
         }
      </style>
   </head>
   <body>
      <div class="container">
         <h1>üß™ API H√≠brida Tester</h1>

         <div class="test-grid">
            <!-- Test 1: Chat Simple -->
            <div class="test-card">
               <div class="test-title">ü§ñ Chat Simple</div>
               <div class="test-description">Dolphin-Mistral 24B - R√°pido y econ√≥mico</div>
               <textarea id="prompt1" placeholder="Escribe tu pregunta...">
Expl√≠came qu√© es React en palabras simples</textarea
               >
               <button onclick="testSimple()">Probar Chat Simple</button>
               <div id="response1" class="response" style="display: none"></div>
            </div>

            <!-- Test 2: Memoria -->
            <div class="test-card">
               <div class="test-title">üß† Chat con Memoria</div>
               <div class="test-description">GPT-OSS 20B - Recuerda la conversaci√≥n</div>
               <textarea id="prompt2" placeholder="Dile algo sobre ti...">
Mi nombre es Juan, soy dise√±ador gr√°fico y me encanta el anime</textarea
               >
               <button onclick="testMemory()">Establecer Memoria</button>
               <button onclick="testMemoryRecall()" style="margin-top: 10px">Probar Memoria</button>
               <div id="response2" class="response" style="display: none"></div>
            </div>

            <!-- Test 3: Conocimiento -->
            <div class="test-card">
               <div class="test-title">üìö Base de Conocimiento</div>
               <div class="test-description">GPT-OSS 20B - Aprende y ense√±a</div>
               <textarea id="prompt3" placeholder="Ense√±a algo nuevo...">
Aprende: Figma es una herramienta de dise√±o colaborativo basada en la web</textarea
               >
               <button onclick="testKnowledge()">Ense√±ar Conocimiento</button>
               <button onclick="testKnowledgeQuery()" style="margin-top: 10px">
                  Consultar Conocimiento
               </button>
               <div id="response3" class="response" style="display: none"></div>
            </div>

            <!-- Test 4: H√≠brido -->
            <div class="test-card">
               <div class="test-title">üéØ H√≠brido Completo</div>
               <div class="test-description">Memoria + Conocimiento + Herramientas</div>
               <textarea id="prompt4" placeholder="Pregunta compleja...">
Bas√°ndote en mi perfil y lo que sabes de herramientas de dise√±o, ¬øqu√© me recomiendas?</textarea
               >
               <button onclick="testHybrid()">Test Completo</button>
               <div id="response4" class="response" style="display: none"></div>
            </div>
         </div>

         <div style="text-align: center; color: #666; margin-top: 20px">
            <p>üí° Tip: Primero establece memoria y conocimiento, luego prueba el h√≠brido</p>
         </div>
      </div>

      <script>
         const API_BASE = 'http://localhost:3000/api/chat';
         let conversationId = crypto.randomUUID();

         function generateUUID() {
            return crypto.randomUUID();
         }

         async function makeRequest(prompt, options = {}) {
            const payload = {
               prompt,
               conversationId,
               ...options,
            };

            try {
               const response = await fetch(API_BASE, {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify(payload),
               });

               const data = await response.json();
               return { success: true, data };
            } catch (error) {
               return { success: false, error: error.message };
            }
         }

         function displayResponse(elementId, result, loading = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';

            if (loading) {
               element.className = 'response loading';
               element.textContent = 'üîÑ Procesando...';
               return;
            }

            if (result.success) {
               element.className = 'response success';
               const info =
                  `üí¨ Mensaje: ${result.data.message}\n\n` +
                  `ü§ñ Modelo: ${result.data.modelUsed}\n` +
                  `üîß Herramientas: ${result.data.toolsUsed?.join(', ') || 'Ninguna'}\n` +
                  `üì± ID: ${result.data.conversationId}`;
               element.textContent = info;
            } else {
               element.className = 'response error';
               element.textContent = `‚ùå Error: ${result.error}`;
            }
         }

         async function testSimple() {
            const prompt = document.getElementById('prompt1').value;
            displayResponse('response1', null, true);

            const result = await makeRequest(prompt, {
               modelType: 'simple',
            });

            displayResponse('response1', result);
         }

         async function testMemory() {
            const prompt = document.getElementById('prompt2').value;
            displayResponse('response2', null, true);

            const result = await makeRequest(prompt, {
               modelType: 'memory',
               useMemory: true,
            });

            displayResponse('response2', result);
         }

         async function testMemoryRecall() {
            displayResponse('response2', null, true);

            const result = await makeRequest('¬øPodr√≠as resumir lo que me conoces?', {
               modelType: 'memory',
               useMemory: true,
            });

            displayResponse('response2', result);
         }

         async function testKnowledge() {
            const prompt = document.getElementById('prompt3').value;
            displayResponse('response3', null, true);

            const result = await makeRequest(prompt, {
               modelType: 'with_tools',
               useKnowledgeBase: true,
            });

            displayResponse('response3', result);
         }

         async function testKnowledgeQuery() {
            displayResponse('response3', null, true);

            const result = await makeRequest('¬øQu√© puedes contarme sobre herramientas de dise√±o?', {
               modelType: 'with_tools',
               useKnowledgeBase: true,
            });

            displayResponse('response3', result);
         }

         async function testHybrid() {
            const prompt = document.getElementById('prompt4').value;
            displayResponse('response4', null, true);

            const result = await makeRequest(prompt, {
               modelType: 'with_tools',
               useMemory: true,
               useKnowledgeBase: true,
            });

            displayResponse('response4', result);
         }
      </script>
   </body>
</html>
